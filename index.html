<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuestro Álbum Compartido - Vista Especial</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&family=Cormorant+Garamond:wght@400;500&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cormorant Garamond', serif;
            background: linear-gradient(135deg, #fce4ec 0%, #f3e5f5 50%, #fce4ec 100%);
            min-height: 100vh;
            color: #5a3a5a;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* RELOJ DE CORAZÓN UNIVERSAL */
        .heart-clock-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 600;
        }

        .heart-clock {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #ff6b9d 0%, #ff1493 100%);
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            position: relative;
            box-shadow: 0 10px 30px rgba(255, 20, 147, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            animation: heartbeatClock 1.5s ease-in-out infinite;
        }

        .clock-face {
            width: 85px;
            height: 85px;
            background: white;
            border-radius: 50%;
            transform: rotate(45deg);
            position: relative;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .clock-center {
            width: 10px;
            height: 10px;
            background: #ff1493;
            border-radius: 50%;
            position: absolute;
            z-index: 10;
        }

        .hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            border-radius: 10px;
        }

        .hour-hand {
            width: 5px;
            height: 20px;
            background: #ff1493;
            margin-left: -2.5px;
        }

        .minute-hand {
            width: 3px;
            height: 28px;
            background: #ff6b9d;
            margin-left: -1.5px;
        }

        .second-hand {
            width: 2px;
            height: 28px;
            background: #ffb6d9;
            margin-left: -1px;
        }

        @keyframes heartbeatClock {
            0%, 100% {
                transform: rotate(-45deg) scale(1);
            }
            14% {
                transform: rotate(-45deg) scale(1.08);
            }
            28% {
                transform: rotate(-45deg) scale(1);
            }
        }

        /* CONTADOR DE ROSAS UNIVERSAL */
        .roses-counter {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            padding: 18px 20px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid #f48fb1;
            z-index: 600;
            box-shadow: 0 15px 40px rgba(193, 24, 91, 0.25);
            animation: slideInRight 0.8s ease-out;
            max-width: 240px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .roses-counter:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 50px rgba(193, 24, 91, 0.35);
            border-color: #ec407a;
        }

        .roses-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.1em;
            color: #c2185b;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .roses-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
            max-height: 110px;
            overflow-y: auto;
            padding: 8px;
            background: linear-gradient(135deg, rgba(255, 182, 217, 0.1) 0%, rgba(243, 229, 245, 0.1) 100%);
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .rose {
            font-size: 1.25em;
            animation: roseAppear 0.5s ease-out;
            transition: all 0.3s ease;
            cursor: pointer;
            filter: drop-shadow(0 2px 3px rgba(255, 105, 180, 0.3));
        }

        .rose:hover {
            transform: scale(1.3) rotate(15deg);
            filter: drop-shadow(0 4px 8px rgba(255, 20, 147, 0.5));
        }

        @keyframes roseAppear {
            0% {
                opacity: 0;
                transform: scale(0) rotate(-180deg);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        .roses-message {
            font-size: 0.8em;
            color: #c2185b;
            margin-bottom: 8px;
            font-style: italic;
            font-weight: 600;
            letter-spacing: 0.5px;
            line-height: 1.4;
        }

        .roses-details {
            font-size: 0.75em;
            color: #8e3b5c;
            padding-top: 8px;
            border-top: 1px solid rgba(244, 143, 177, 0.3);
            display: none;
        }

        .roses-details.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 200px;
            }
        }

        .rose-count {
            font-family: 'Playfair Display', serif;
            font-size: 1.3em;
            color: #c2185b;
            font-weight: 700;
            margin: 5px 0;
        }

        .rose-time {
            color: #ad1457;
            font-weight: 500;
        }

        .rose-progress {
            width: 100%;
            height: 4px;
            background: rgba(244, 143, 177, 0.2);
            border-radius: 10px;
            margin: 8px 0;
            overflow: hidden;
        }

        .rose-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #f48fb1 0%, #ec407a 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .roses-counter::-webkit-scrollbar {
            width: 4px;
        }

        .roses-counter::-webkit-scrollbar-track {
            background: rgba(244, 143, 177, 0.1);
            border-radius: 10px;
        }

        .roses-counter::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #f48fb1 0%, #ec407a 100%);
            border-radius: 10px;
        }

        /* ESTILOS DEL LOGIN */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 60px 50px;
            box-shadow: 0 25px 80px rgba(193, 24, 91, 0.2);
            border: 2px solid rgba(193, 24, 91, 0.1);
            max-width: 450px;
            width: 100%;
            animation: slideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .login-box h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.8em;
            color: #c2185b;
            text-align: center;
            margin-bottom: 15px;
            letter-spacing: 2px;
            text-shadow: 0 2px 4px rgba(193, 24, 91, 0.1);
        }

        .login-box .heart-icon {
            display: block;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 25px;
            animation: heartBeat 1.5s ease-in-out infinite;
        }

        .login-subtitle {
            text-align: center;
            color: #ad1457;
            margin-bottom: 40px;
            font-size: 1.1em;
            font-style: italic;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-form label {
            font-size: 1.05em;
            color: #5a3a5a;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .login-form input {
            padding: 14px 16px;
            border: 2px solid #f48fb1;
            border-radius: 12px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.05em;
            color: #5a3a5a;
            background: rgba(244, 143, 177, 0.05);
            transition: all 0.3s ease;
        }

        .login-form input:focus {
            outline: none;
            border-color: #c2185b;
            background: rgba(244, 143, 177, 0.1);
            box-shadow: 0 0 20px rgba(193, 24, 91, 0.2);
            transform: translateY(-2px);
        }

        .login-form input::placeholder {
            color: #b39ddb;
        }

        .login-btn {
            padding: 14px;
            background: linear-gradient(135deg, #c2185b 0%, #ad1457 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.15em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(193, 24, 91, 0.3);
            margin-top: 10px;
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(193, 24, 91, 0.4);
        }

        .login-btn:active {
            transform: translateY(-1px);
        }

        .error-message {
            color: #f44336;
            text-align: center;
            font-size: 0.95em;
            display: none;
            padding: 12px;
            background: rgba(244, 67, 54, 0.1);
            border-radius: 10px;
            border-left: 4px solid #f44336;
            margin-bottom: 15px;
            animation: shake 0.5s ease-in-out;
        }

        .error-message.show {
            display: block;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* ESTILOS PRINCIPALES */
        .hidden {
            display: none !important;
        }

        .main-content {
            padding: 40px 20px 100px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
            animation: fadeInDown 1s ease-out;
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.2em;
            color: #c2185b;
            margin-bottom: 12px;
            letter-spacing: 2px;
            text-shadow: 0 2px 4px rgba(193, 24, 91, 0.1);
        }

        .header p {
            font-size: 1.3em;
            color: #ad1457;
            margin-bottom: 15px;
        }

        .user-info {
            background: linear-gradient(135deg, rgba(244, 143, 177, 0.2) 0%, rgba(243, 229, 245, 0.2) 100%);
            padding: 12px 28px;
            border-radius: 25px;
            display: inline-block;
            margin-bottom: 20px;
            border: 2px solid #f48fb1;
            font-size: 1.1em;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(193, 24, 91, 0.1);
        }

        .user-info span {
            font-weight: 600;
            color: #c2185b;
        }

        /* OPCIONES DE FORMATOS */
        .format-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .format-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 35px;
            text-align: center;
            border: 2px solid rgba(193, 24, 91, 0.1);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            animation: fadeInUp 0.8s ease-out backwards;
            box-shadow: 0 10px 35px rgba(193, 24, 91, 0.12);
        }

        .format-card:nth-child(1) { animation-delay: 0.1s; }
        .format-card:nth-child(2) { animation-delay: 0.2s; }
        .format-card:nth-child(3) { animation-delay: 0.3s; }
        .format-card:nth-child(4) { animation-delay: 0.4s; }
        .format-card:nth-child(5) { animation-delay: 0.5s; }
        .format-card:nth-child(6) { animation-delay: 0.6s; }
        .format-card:nth-child(7) { animation-delay: 0.7s; }
        .format-card:nth-child(8) { animation-delay: 0.8s; }

        .format-card:hover {
            transform: translateY(-15px) scale(1.05);
            box-shadow: 0 25px 60px rgba(193, 24, 91, 0.25);
            border-color: #f48fb1;
        }

        .format-icon {
            font-size: 2.8em;
            margin-bottom: 12px;
        }

        .format-card h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.5em;
            color: #c2185b;
            margin-bottom: 10px;
        }

        .format-card p {
            font-size: 0.95em;
            color: #8e3b5c;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .format-btn {
            padding: 11px 30px;
            background: linear-gradient(135deg, #c2185b 0%, #ad1457 100%);
            color: white;
            border: none;
            border-radius: 20px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(193, 24, 91, 0.3);
            font-weight: 600;
        }

        .format-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(193, 24, 91, 0.4);
        }

        /* BOTÓN LOGOUT */
        .logout-btn {
            position: fixed;
            top: 130px;
            left: 20px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #ec407a 0%, #c2185b 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.95em;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(193, 24, 91, 0.3);
            z-index: 600;
            font-weight: 600;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(193, 24, 91, 0.4);
        }

        /* VISTA PÚBLICA DEL ÁLBUM */
        .public-header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 1s ease-out;
        }

        .public-header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.2em;
            color: #c2185b;
            margin-bottom: 12px;
            letter-spacing: 2px;
        }

        .public-info {
            background: linear-gradient(135deg, rgba(244, 143, 177, 0.2) 0%, rgba(243, 229, 245, 0.2) 100%);
            padding: 15px 25px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 20px;
            border: 2px solid #f48fb1;
            font-size: 1.05em;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(193, 24, 91, 0.1);
        }

        .public-info strong {
            color: #c2185b;
        }

        .public-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
            animation: fadeInUp 0.8s ease-out;
        }

        .public-btn {
            padding: 15px;
            background: linear-gradient(135deg, #c2185b 0%, #ad1457 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(193, 24, 91, 0.3);
            text-align: center;
        }

        .public-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(193, 24, 91, 0.4);
        }

        /* VISTAS DE FOTOS */
        .viewer-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(193, 24, 91, 0.15);
            border: 1px solid rgba(193, 24, 91, 0.1);
            margin-bottom: 40px;
            animation: fadeInUp 0.8s ease-out;
        }

        .back-btn {
            display: inline-block;
            padding: 11px 25px;
            background: linear-gradient(135deg, #f48fb1 0%, #ec407a 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.95em;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(193, 24, 91, 0.3);
            margin-bottom: 30px;
            font-weight: 600;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(193, 24, 91, 0.4);
        }

        /* FORMULARIO DE CARGA */
        .upload-form {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(245, 229, 245, 0.95) 100%);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(193, 24, 91, 0.15);
            border: 2px solid rgba(193, 24, 91, 0.1);
        }

        .upload-form h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2em;
            color: #c2185b;
            margin-bottom: 30px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-size: 1.1em;
            color: #5a3a5a;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #f48fb1;
            border-radius: 12px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.05em;
            color: #5a3a5a;
            background: rgba(244, 143, 177, 0.05);
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #c2185b;
            background: rgba(244, 143, 177, 0.1);
            box-shadow: 0 0 20px rgba(193, 24, 91, 0.2);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
            font-family: 'Cormorant Garamond', serif;
        }

        .file-input-wrapper {
            position: relative;
            width: 100%;
        }

        .file-input-label {
            display: block;
            padding: 25px;
            background: linear-gradient(135deg, #c2185b 0%, #ad1457 100%);
            color: white;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(193, 24, 91, 0.3);
        }

        .file-input-label:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(193, 24, 91, 0.4);
        }

        #photoInput, #videoInput {
            display: none;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #c2185b 0%, #ad1457 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.15em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(193, 24, 91, 0.3);
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(193, 24, 91, 0.4);
        }

        .submit-btn:active {
            transform: translateY(-1px);
        }

        .message {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 0.95em;
            display: none;
            animation: slideDown 0.3s ease-out;
        }

        .message.success {
            background: rgba(76, 175, 80, 0.1);
            border-left: 4px solid #4CAF50;
            color: #4CAF50;
            display: block;
        }

        .message.error {
            background: rgba(244, 67, 54, 0.1);
            border-left: 4px solid #f44336;
            color: #f44336;
            display: block;
        }

        /* PREVISUALIZACIÓN */
        .preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid rgba(244, 143, 177, 0.2);
        }

        .preview-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(193, 24, 91, 0.15);
            transition: all 0.3s ease;
            animation: zoomIn 0.5s ease-out;
        }

        .preview-item:hover {
            transform: scale(1.08);
            box-shadow: 0 10px 25px rgba(193, 24, 91, 0.25);
        }

        .preview-item img,
        .preview-item video {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }

        .preview-delete {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(244, 67, 54, 0.9);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.2s ease;
            font-weight: bold;
        }

        .preview-delete:hover {
            background: rgba(244, 67, 54, 1);
            transform: scale(1.1);
        }

        .preview-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: white;
            padding: 8px;
            font-size: 0.8em;
            text-align: center;
        }

        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* MODAL DE COMPARTIR */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            animation: fadeIn 0.3s ease-out;
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            position: relative;
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2em;
            color: #c2185b;
            margin-bottom: 10px;
        }

        .modal-header p {
            color: #8e3b5c;
            font-size: 0.95em;
        }

        .share-url {
            background: rgba(244, 143, 177, 0.1);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #f48fb1;
        }

        .share-url input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-size: 0.9em;
            background: white;
            color: #5a3a5a;
            margin-bottom: 10px;
        }

        .copy-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1em;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .copy-btn.copied {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #ec407a 0%, #c2185b 100%);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5em;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .close-modal:hover {
            transform: scale(1.1);
        }

        .tabs-upload {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tab-link {
            padding: 12px 25px;
            background: rgba(244, 143, 177, 0.2);
            border: 2px solid #f48fb1;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1em;
            color: #5a3a5a;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab-link.active {
            background: linear-gradient(135deg, #f48fb1 0%, #ec407a 100%);
            color: white;
            border-color: #c2185b;
        }

        .tab-link:hover {
            background: rgba(244, 143, 177, 0.3);
        }

        .tab-content-upload {
            display: none;
        }

        .tab-content-upload.active {
            display: block;
        }

        .carousel {
            position: relative;
            width: 100%;
            height: 500px;
            border-radius: 20px;
            overflow: hidden;
            background: linear-gradient(135deg, #fce4ec 0%, #f3e5f5 100%);
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .carousel-slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .carousel-slide.active {
            opacity: 1;
        }

        .carousel-slide img,
        .carousel-slide video {
            max-width: 100%;
            max-height: 100%;
            border-radius: 15px;
            object-fit: contain;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .carousel-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .carousel-btn {
            padding: 10px 25px;
            background: linear-gradient(135deg, #f48fb1 0%, #ec407a 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.95em;
            transition: all 0.3s ease;
            box-shadow: 0 5px 12px rgba(193, 24, 91, 0.3);
            font-weight: 600;
        }

        .carousel-btn:hover {
            transform: translateY(-2px);
        }

        .carousel-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .slide-counter {
            font-size: 1em;
            color: #c2185b;
            font-weight: 600;
            min-width: 80px;
            text-align: center;
        }

        .slide-info {
            text-align: center;
            padding: 20px;
            background: rgba(244, 143, 177, 0.05);
            border-radius: 15px;
            margin-top: 20px;
            border: 1px solid rgba(244, 143, 177, 0.2);
        }

        .slide-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.6em;
            color: #c2185b;
            margin-bottom: 8px;
        }

        .slide-date {
            font-size: 0.95em;
            color: #8e3b5c;
            margin-bottom: 10px;
        }

        .slide-message {
            font-size: 1.05em;
            color: #5a3a5a;
            font-style: italic;
            line-height: 1.6;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .grid-item {
            background: white;
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(193, 24, 91, 0.15);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
            animation: fadeIn 0.6s ease-out backwards;
        }

        .grid-item:hover {
            transform: translateY(-12px) scale(1.05);
            box-shadow: 0 20px 50px rgba(193, 24, 91, 0.25);
        }

        .grid-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .grid-info {
            padding: 18px;
            background: white;
        }

        .grid-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.15em;
            color: #c2185b;
            margin-bottom: 6px;
        }

        .grid-date {
            font-size: 0.85em;
            color: #8e3b5c;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #ad1457;
            grid-column: 1 / -1;
        }

        .empty-state h3 {
            font-family: 'Playfair Display', serif;
            font-size: 2.2em;
            margin-bottom: 15px;
        }

        .empty-state p {
            font-size: 1.1em;
            opacity: 0.8;
        }

        /* SECCIÓN DE MÚSICA */
        .music-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(245, 229, 245, 0.95) 100%);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(193, 24, 91, 0.15);
            border: 2px solid rgba(193, 24, 91, 0.1);
        }

        .music-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2em;
            color: #c2185b;
            margin-bottom: 30px;
            text-align: center;
        }

        .music-input-group {
            margin-bottom: 25px;
        }

        .music-input-group label {
            display: block;
            font-size: 1.1em;
            color: #5a3a5a;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .music-input-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #f48fb1;
            border-radius: 12px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.05em;
            color: #5a3a5a;
            background: rgba(244, 143, 177, 0.05);
            transition: all 0.3s ease;
        }

        .music-input-group input:focus {
            outline: none;
            border-color: #c2185b;
            background: rgba(244, 143, 177, 0.1);
            box-shadow: 0 0 20px rgba(193, 24, 91, 0.2);
        }

        .music-help {
            background: rgba(76, 175, 80, 0.1);
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid #4CAF50;
            margin-bottom: 25px;
            font-size: 0.95em;
            color: #5a3a5a;
            line-height: 1.6;
        }

        .music-help strong {
            color: #4CAF50;
        }

        .music-preview {
            background: rgba(244, 143, 177, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid #f48fb1;
        }

        .music-preview h3 {
            font-family: 'Playfair Display', serif;
            color: #c2185b;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .music-player {
            width: 100%;
            height: 50px;
            margin-bottom: 15px;
        }

        .music-controls {
            display: flex;
            gap: 10px;
        }

        .music-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .music-save-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .music-save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
        }

        .music-clear-btn {
            background: linear-gradient(135deg, #f48fb1 0%, #ec407a 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(193, 24, 91, 0.3);
        }

        .music-clear-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(193, 24, 91, 0.4);
        }

        .music-volume-control {
            margin-bottom: 15px;
        }

        .music-volume-control label {
            display: block;
            font-size: 1em;
            color: #5a3a5a;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .volume-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(244, 143, 177, 0.2);
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f48fb1 0%, #ec407a 100%);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(193, 24, 91, 0.3);
        }

        .volume-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f48fb1 0%, #ec407a 100%);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(193, 24, 91, 0.3);
            border: none;
        }

        .music-status {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
            margin-top: 15px;
        }

        .music-status.active {
            background: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
            border: 1px solid #4CAF50;
        }

        .music-status.inactive {
            background: rgba(158, 158, 158, 0.1);
            color: #757575;
            border: 1px solid #9e9e9e;
        }

        .youtube-info {
            background: rgba(255, 193, 7, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #FFC107;
            font-size: 0.9em;
            color: #5a3a5a;
        }

        /* NOTIFICACIÓN DE FOTO EXITOSA */
        .photo-success-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            animation: slideInRight 0.5s ease-out;
        }

        .photo-success-notification.fade-out {
            animation: slideOutRight 0.3s ease-out;
        }

        .notification-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(76, 175, 80, 0.25);
            border-left: 5px solid #4CAF50;
            overflow: hidden;
            max-width: 380px;
            width: 100%;
        }

        .notification-header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            font-size: 1.1em;
        }

        .notification-preview {
            padding: 20px;
            display: flex;
            gap: 15px;
        }

        .preview-image {
            flex-shrink: 0;
            width: 120px;
            height: 120px;
            border-radius: 10px;
            overflow: hidden;
            background: #f0f0f0;
        }

        .preview-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .preview-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.1em;
            color: #c2185b;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .preview-date {
            font-size: 0.85em;
            color: #999;
            margin-bottom: 8px;
        }

        .preview-message {
            font-size: 0.9em;
            color: #5a3a5a;
            line-height: 1.4;
            max-height: 50px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .notification-stats {
            background: rgba(76, 175, 80, 0.05);
            padding: 15px 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }

        .stat-label {
            font-size: 0.8em;
            color: #999;
            margin-bottom: 3px;
        }

        .stat-value {
            font-family: 'Playfair Display', serif;
            font-size: 1.3em;
            color: #4CAF50;
            font-weight: 700;
        }

        .notification-footer {
            padding: 12px 20px;
            background: rgba(76, 175, 80, 0.1);
            border-top: 1px solid rgba(76, 175, 80, 0.2);
            text-align: center;
        }

        .notification-footer p {
            margin: 0;
            font-size: 0.9em;
            color: #4CAF50;
            font-weight: 600;
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(400px);
            }
        }

        @media (max-width: 480px) {
            .photo-success-notification {
                top: 10px;
                right: 10px;
                left: 10px;
            }

            .notification-card {
                max-width: 100%;
            }

            .notification-preview {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .preview-image {
                width: 100%;
                height: 150px;
            }
        }

        /* TABS DE MÚSICA */
        .music-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #f48fb1;
            overflow-x: auto;
        }

        .music-tab-btn {
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: #8e3b5c;
            cursor: pointer;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .music-tab-btn:hover {
            color: #c2185b;
            background: rgba(244, 143, 177, 0.05);
        }

        .music-tab-btn.active {
            color: #c2185b;
            border-bottom-color: #c2185b;
        }

        .music-tab-content {
            display: none;
            animation: fadeInUp 0.3s ease-out;
        }

        .music-tab-content.active {
            display: block;
        }

        /* PLATAFORMAS DE MÚSICA LIBRE */
        .free-music-platforms {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .platform-card {
            background: white;
            border: 2px solid #f48fb1;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .platform-card:hover {
            transform: translateY(-8px);
            border-color: #c2185b;
            box-shadow: 0 10px 30px rgba(193, 24, 91, 0.15);
        }

        .platform-icon {
            font-size: 2.5em;
            margin-bottom: 12px;
        }

        .platform-card h4 {
            font-family: 'Playfair Display', serif;
            color: #c2185b;
            font-size: 1.3em;
            margin-bottom: 8px;
        }

        .platform-card p {
            color: #8e3b5c;
            font-size: 0.9em;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .platform-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(135deg, #f48fb1 0%, #ec407a 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.3s ease;
            font-family: 'Cormorant Garamond', serif;
        }

        .platform-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(193, 24, 91, 0.3);
        }

        /* CARGAR ARCHIVO DE MÚSICA */
        #musicFileInput {
            display: none;
        }

        .file-input-wrapper {
            position: relative;
            width: 100%;
        }

        .file-input-label {
            display: block;
            padding: 25px;
            background: linear-gradient(135deg, #c2185b 0%, #ad1457 100%);
            color: white;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(193, 24, 91, 0.3);
        }

        .file-input-label:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(193, 24, 91, 0.4);
        }

        /* MENSAJE DE MÚSICA CARGADA */
        .music-success-message {
            display: none;
            background: rgba(76, 175, 80, 0.1);
            border-left: 4px solid #4CAF50;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: #4CAF50;
            font-weight: 600;
            animation: slideDown 0.3s ease-out;
        }

        .music-success-message.show {
            display: block;
        }

        /* LLUVIA DE ROSAS AL LOGIN */
        @keyframes roseRainFall {
            0% {
                transform: translateY(-10vh) rotate(0deg);
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes roseSwing {
            0%, 100% {
                transform: translateX(0);
            }
            50% {
                transform: translateX(30px);
            }
        }

        .rose-rain {
            position: fixed;
            top: -10vh;
            font-size: 2em;
            z-index: 9999;
            pointer-events: none;
            animation: roseRainFall linear forwards, roseSwing ease-in-out infinite;
            text-shadow: 0 2px 4px rgba(255, 20, 147, 0.3);
        }

        .rose-rain-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        .footer {
            text-align: center;
            margin-top: 60px;
            padding-bottom: 30px;
            color: #ad1457;
            font-size: 0.95em;
            opacity: 0.8;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        @keyframes heartBeat {
            0%, 100% {
                transform: scale(1);
            }
            14% {
                transform: scale(1.3);
            }
            28% {
                transform: scale(1);
            }
        }

        @media (max-width: 768px) {
            .login-box {
                padding: 40px 30px;
            }

            .login-box h1 {
                font-size: 2.2em;
            }

            .carousel {
                height: 350px;
            }

            .carousel-slide {
                padding: 20px;
            }

            .carousel-slide img,
            .carousel-slide video {
                max-height: 80%;
            }

            .grid-container {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }

            .format-options {
                grid-template-columns: repeat(2, 1fr);
            }

            .heart-clock-container {
                top: 10px;
                left: 10px;
            }

            .heart-clock {
                width: 80px;
                height: 80px;
            }

            .clock-face {
                width: 68px;
                height: 68px;
            }

            .roses-counter {
                bottom: 10px;
                right: 10px;
                max-width: 160px;
            }

            .logout-btn {
                top: 100px;
                left: 10px;
                padding: 8px 15px;
                font-size: 0.85em;
            }

            .main-content {
                padding: 30px 15px 80px 15px;
            }

            .header h1 {
                font-size: 2.2em;
            }

            .viewer-container {
                padding: 25px;
            }

            .preview-container {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .format-options {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .login-box {
                padding: 30px 20px;
                max-width: 100%;
            }

            .heart-clock {
                width: 70px;
                height: 70px;
            }

            .roses-counter {
                padding: 12px 15px;
                max-width: 150px;
            }

            .modal-content {
                width: 95%;
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- RELOJ DE CORAZÓN (SIEMPRE VISIBLE) -->
    <div class="heart-clock-container">
        <div class="heart-clock">
            <div class="clock-face">
                <div class="hand hour-hand" id="hourHand"></div>
                <div class="hand minute-hand" id="minuteHand"></div>
                <div class="hand second-hand" id="secondHand"></div>
                <div class="clock-center"></div>
            </div>
        </div>
    </div>

    <!-- CONTADOR DE ROSAS (SIEMPRE VISIBLE) -->
    <div class="roses-counter" id="rosesCounter" onclick="toggleRosesDetails()">
        <div class="roses-title">🌹 Rosas de Amor</div>
        <div class="roses-container" id="rosesContainer"></div>
        <div class="roses-message">Una rosa por cada mes juntos ❤️</div>
        <div class="roses-details" id="rosesDetails">
            <div class="rose-count" id="roseCount">29 Rosas</div>
            <div class="rose-time" id="roseTime">Desde el 14 de Febrero</div>
            <div class="rose-progress">
                <div class="rose-progress-bar" id="roseProgress"></div>
            </div>
            <div id="nextRoseDate" style="font-size: 0.7em; color: #ad1457; margin-top: 5px; font-weight: 500;">
                Próxima rosa en...
            </div>
        </div>
    </div>

    <!-- LOGIN -->
    <div id="loginContainer" class="login-container">
        <div class="login-box">
            <h1>💕 Nuestro Amor 💕</h1>
            <div class="heart-icon">💗</div>
            <p class="login-subtitle">Galería Compartida Especial</p>

            <div class="error-message" id="errorMessage"></div>

            <form id="loginForm" onsubmit="login(event)">
                <div>
                    <label for="username">👤 Usuario</label>
                    <input type="text" id="username" placeholder="Ingresa tu usuario" required autocomplete="off">
                </div>
                
                <div>
                    <label for="password">🔐 Contraseña</label>
                    <input type="password" id="password" placeholder="Ingresa tu contraseña" required autocomplete="off">
                </div>
                
                <button type="submit" class="login-btn">🔓 Ingresar</button>
            </form>
        </div>
    </div>

    <!-- APLICACIÓN PRINCIPAL -->
    <div id="mainApp" class="hidden">
        <button class="logout-btn" onclick="logout()">🚪 Salir</button>

        <div class="main-content">
            <div class="container">
                <div class="header">
                    <h1>🌹 Nuestro Álbum Compartido 🌹</h1>
                    <div class="user-info">
                        Bienvenido <span id="userName">REY</span> 💕
                    </div>
                </div>

                <!-- MENÚ PRINCIPAL -->
                <div id="mainMenu" class="format-options">
                    <div class="format-card">
                        <div class="format-icon">➕</div>
                        <h2>Subir Contenido</h2>
                        <p>Carga tus fotos y videos especiales</p>
                        <button class="format-btn" onclick="showView('upload')">Subir</button>
                    </div>

                    <div class="format-card">
                        <div class="format-icon">🎵</div>
                        <h2>Música de Fondo</h2>
                        <p>Agrega una canción para la presentación</p>
                        <button class="format-btn" onclick="showView('music')">Configurar</button>
                    </div>

                    <div class="format-card">
                        <div class="format-icon">🎠</div>
                        <h2>Carrusel</h2>
                        <p>Disfruta nuestros momentos en una presentación deslizante</p>
                        <button class="format-btn" onclick="showView('carousel')">Ver</button>
                    </div>

                    <div class="format-card">
                        <div class="format-icon">📊</div>
                        <h2>Rejilla</h2>
                        <p>Galería ordenada y moderna</p>
                        <button class="format-btn" onclick="showView('grid')">Ver</button>
                    </div>

                    <div class="format-card">
                        <div class="format-icon">🔗</div>
                        <h2>Álbum Público</h2>
                        <p>Comparte tu álbum con una URL pública</p>
                        <button class="format-btn" onclick="showShareModal()">Compartir</button>
                    </div>
                </div>

                <!-- VISTA DE CARGA -->
                <div id="uploadView" class="hidden">
                    <div class="viewer-container">
                        <button class="back-btn" onclick="backToMenu()">← Volver al Menú</button>
                        
                        <div class="upload-form">
                            <h2>📸 Sube tu Contenido Especial</h2>
                            
                            <div class="tabs-upload">
                                <button class="tab-link active" onclick="switchUploadTab('photos')">📸 Fotos</button>
                                <button class="tab-link" onclick="switchUploadTab('videos')">🎥 Videos</button>
                            </div>

                            <!-- TAB FOTOS -->
                            <div id="photos-tab" class="tab-content-upload active">
                                <form id="photoForm" onsubmit="uploadPhoto(event)">
                                    <div class="form-group">
                                        <label for="photoDate">📅 Fecha del Momento:</label>
                                        <input type="date" id="photoDate" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="photoTitle">✨ Título o Detalle:</label>
                                        <input type="text" id="photoTitle" placeholder="Ej: Nuestro primer beso, Cena especial..." required>
                                    </div>

                                    <div class="form-group">
                                        <label for="photoMessage">💌 Mensaje de Amor:</label>
                                        <textarea id="photoMessage" placeholder="Escribe un mensaje especial, palabra de cariño o recuerdo..."></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label for="photoInput">🖼️ Selecciona tu Foto:</label>
                                        <div class="file-input-wrapper">
                                            <label for="photoInput" class="file-input-label">
                                                📸 Haz clic para elegir una foto
                                            </label>
                                            <input type="file" id="photoInput" accept="image/*" required>
                                        </div>
                                    </div>

                                    <div id="photoMessage" class="message"></div>
                                    <button type="submit" class="submit-btn">💾 Guardar Foto</button>
                                </form>
                            </div>

                            <!-- TAB VIDEOS -->
                            <div id="videos-tab" class="tab-content-upload">
                                <form id="videoForm" onsubmit="uploadVideo(event)">
                                    <div class="form-group">
                                        <label for="videoDate">📅 Fecha del Video:</label>
                                        <input type="date" id="videoDate" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="videoTitle">✨ Título del Video:</label>
                                        <input type="text" id="videoTitle" placeholder="Ej: Nuestro viaje especial, Momentos juntos..." required>
                                    </div>

                                    <div class="form-group">
                                        <label for="videoMessage">💌 Descripción o Mensaje:</label>
                                        <textarea id="videoMessage" placeholder="Escribe una descripción o mensaje especial..."></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label for="videoInput">🎥 Selecciona tu Video:</label>
                                        <div class="file-input-wrapper">
                                            <label for="videoInput" class="file-input-label">
                                                🎬 Haz clic para elegir un video (máx. 100MB)
                                            </label>
                                            <input type="file" id="videoInput" accept="video/*" required>
                                        </div>
                                    </div>

                                    <div id="videoMessage" class="message"></div>
                                    <button type="submit" class="submit-btn">🎬 Guardar Video</button>
                                </form>
                            </div>
                        </div>

                        <div>
                            <h2 style="text-align: center; color: #c2185b; margin-top: 50px; margin-bottom: 30px; font-family: 'Playfair Display', serif; font-size: 1.8em;">
                                📷 Contenido Cargado
                            </h2>
                            <div class="preview-container" id="uploadedItems"></div>
                        </div>
                    </div>
                </div>

                <!-- VISTA DE MÚSICA -->
                <div id="musicView" class="hidden">
                    <div class="viewer-container">
                        <button class="back-btn" onclick="backToMenu()">← Volver al Menú</button>
                        
                        <div class="music-section">
                            <h2>🎵 Música de Fondo para la Presentación</h2>
                            
                            <div class="music-tabs">
                                <button class="music-tab-btn active" onclick="switchMusicTab('youtube')">
                                    📺 YouTube
                                </button>
                                <button class="music-tab-btn" onclick="switchMusicTab('upload')">
                                    📁 Subir Archivo
                                </button>
                                <button class="music-tab-btn" onclick="switchMusicTab('free')">
                                    🎵 Música Libre
                                </button>
                            </div>

                            <!-- TAB: YOUTUBE -->
                            <div id="youtube-tab" class="music-tab-content active">
                                <div class="music-help">
                                    <strong>📺 ¿Cómo agregar música YouTube?</strong><br>
                                    1. Abre un video en YouTube<br>
                                    2. Copia la URL del navegador (ej: https://www.youtube.com/watch?v=...)<br>
                                    3. Pégala en el campo de abajo<br>
                                    4. ¡La música sonará en tus presentaciones!
                                </div>

                                <div class="music-input-group">
                                    <label for="musicUrl">🎬 URL de YouTube:</label>
                                    <input type="text" id="musicUrl" placeholder="https://www.youtube.com/watch?v=... o https://youtu.be/...">
                                </div>

                                <div class="music-volume-control">
                                    <label>🔊 Volumen: <span id="volumeDisplay">70</span>%</label>
                                    <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="70" oninput="updateVolumeDisplay(this.value)">
                                </div>

                                <div class="music-preview">
                                    <h3>🎧 Vista Previa</h3>
                                    <div id="musicEmbed"></div>
                                    <div id="musicStatus" class="music-status inactive">
                                        🔇 Sin música configurada
                                    </div>
                                </div>

                                <div class="music-controls">
                                    <button class="music-btn music-save-btn" onclick="saveBackgroundMusic()">💾 Guardar Música</button>
                                    <button class="music-btn music-clear-btn" onclick="clearBackgroundMusic()">🗑️ Eliminar Música</button>
                                </div>
                            </div>

                            <!-- TAB: SUBIR ARCHIVO -->
                            <div id="upload-tab" class="music-tab-content">
                                <div class="music-help">
                                    <strong>📁 Subir archivo de música local</strong><br>
                                    1. Descarga una canción (MP3, WAV, OGG)<br>
                                    2. Sube el archivo aquí<br>
                                    3. ¡Reproducirá automáticamente en presentaciones!
                                </div>

                                <div class="music-input-group">
                                    <label>📁 Selecciona archivo de música:</label>
                                    <div class="file-input-wrapper">
                                        <label for="musicFileInput" class="file-input-label">
                                            🎵 Haz clic para elegir archivo (máx 50MB)
                                        </label>
                                        <input type="file" id="musicFileInput" accept="audio/*" onchange="handleMusicFileUpload()">
                                    </div>
                                </div>

                                <div class="music-volume-control">
                                    <label>🔊 Volumen: <span id="uploadVolumeDisplay">70</span>%</label>
                                    <input type="range" id="uploadVolumeSlider" class="volume-slider" min="0" max="100" value="70" oninput="updateUploadVolumeDisplay(this.value)">
                                </div>

                                <div class="music-preview">
                                    <h3>🎧 Previsualización</h3>
                                    <div id="musicUploadPreview"></div>
                                    <div id="uploadMusicStatus" class="music-status inactive">
                                        🔇 Sin archivo cargado
                                    </div>
                                </div>

                                <div class="music-controls">
                                    <button class="music-btn music-save-btn" onclick="saveUploadedMusic()">💾 Guardar Música</button>
                                    <button class="music-btn music-clear-btn" onclick="clearUploadedMusic()">🗑️ Eliminar</button>
                                </div>
                            </div>

                            <!-- TAB: MÚSICA LIBRE -->
                            <div id="free-tab" class="music-tab-content">
                                <div class="music-help">
                                    <strong>🎵 Música sin copyright - Plataformas Gratis</strong><br>
                                    Selecciona una plataforma y elige tu canción favorita
                                </div>

                                <div class="free-music-platforms">
                                    <div class="platform-card">
                                        <div class="platform-icon">🎵</div>
                                        <h4>Bensound</h4>
                                        <p>Canciones románticas y relajantes</p>
                                        <a href="https://www.bensound.com" target="_blank" class="platform-btn">
                                            🌐 Ir a Bensound
                                        </a>
                                    </div>

                                    <div class="platform-card">
                                        <div class="platform-icon">📻</div>
                                        <h4>Incompetech</h4>
                                        <p>Música royalty-free de alta calidad</p>
                                        <a href="https://incompetech.com" target="_blank" class="platform-btn">
                                            🌐 Ir a Incompetech
                                        </a>
                                    </div>

                                    <div class="platform-card">
                                        <div class="platform-icon">🎧</div>
                                        <h4>Free Music Archive</h4>
                                        <p>Miles de canciones libres de derechos</p>
                                        <a href="https://freemusicarchive.org" target="_blank" class="platform-btn">
                                            🌐 Ir a FMA
                                        </a>
                                    </div>

                                    <div class="platform-card">
                                        <div class="platform-icon">🎬</div>
                                        <h4>Pixabay Music</h4>
                                        <p>Música gratis sin atribución requerida</p>
                                        <a href="https://pixabay.com/music" target="_blank" class="platform-btn">
                                            🌐 Ir a Pixabay
                                        </a>
                                    </div>

                                    <div class="platform-card">
                                        <div class="platform-icon">🎹</div>
                                        <h4>YouTube Audio Library</h4>
                                        <p>Canciones sin copyright de YouTube</p>
                                        <button class="platform-btn" onclick="showYoutubeAudioInfo()">
                                            ℹ️ Cómo Usar
                                        </button>
                                    </div>

                                    <div class="platform-card">
                                        <div class="platform-icon">🎼</div>
                                        <h4>Chosic</h4>
                                        <p>Colecciones de música libre</p>
                                        <a href="https://www.chosic.com/free-music" target="_blank" class="platform-btn">
                                            🌐 Ir a Chosic
                                        </a>
                                    </div>
                                </div>

                                <div class="music-help" style="margin-top: 30px;">
                                    <strong>💡 Instrucciones:</strong><br>
                                    1. Haz clic en cualquier plataforma<br>
                                    2. Descarga una canción (en MP3 preferentemente)<br>
                                    3. Vuelve aquí y usa la pestaña "Subir Archivo"<br>
                                    4. ¡Listo! Usarás música sin anuncios ni problemas de copyright
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VISTA CARRUSEL -->
                <div id="carouselView" class="hidden">
                    <div class="viewer-container">
                        <button class="back-btn" onclick="backToMenu()">← Volver al Menú</button>
                        <div class="carousel" id="carousel"></div>
                        <div class="carousel-controls">
                            <button class="carousel-btn" onclick="previousSlide()" id="prevBtn">← Anterior</button>
                            <span class="slide-counter"><span id="currentSlide">0</span> / <span id="totalSlides">0</span></span>
                            <button class="carousel-btn" onclick="nextSlide()" id="nextBtn">Siguiente →</button>
                        </div>
                        <div class="slide-info" id="slideInfo"></div>
                    </div>
                </div>

                <!-- VISTA REJILLA -->
                <div id="gridView" class="hidden">
                    <div class="viewer-container">
                        <button class="back-btn" onclick="backToMenu()">← Volver al Menú</button>
                        <div class="grid-container" id="gridContainer"></div>
                    </div>
                </div>

                <!-- MODAL DE COMPARTIR -->
                <div id="shareModal" class="modal">
                    <div class="modal-content">
                        <button class="close-modal" onclick="closeShareModal()">&times;</button>
                        <div class="modal-header">
                            <h2>🔗 Compartir Álbum</h2>
                            <p>Genera un enlace público para compartir tu álbum</p>
                        </div>

                        <div class="share-url">
                            <input type="text" id="shareLink" readonly placeholder="Tu enlace público">
                            <button class="copy-btn" onclick="copyShareLink()">📋 Copiar Enlace</button>
                        </div>

                        <div style="background: rgba(244, 143, 177, 0.1); padding: 15px; border-radius: 10px; margin-top: 20px; text-align: center;">
                            <p style="font-size: 0.9em; color: #5a3a5a; margin-bottom: 10px;">
                                ✨ Este enlace permite que otros vean tu álbum sin necesidad de contraseña
                            </p>
                            <button class="format-btn" onclick="openPublicAlbum()">🌐 Ver como Público</button>
                        </div>
                    </div>
                </div>

                <div class="footer">
                    <p>
                        <span style="display: inline-block; animation: heartBeat 1.5s ease-in-out infinite;">❤️</span>
                        Hecho con amor para ustedes
                        <span style="display: inline-block; animation: heartBeat 1.5s ease-in-out infinite;">❤️</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DATOS DE USUARIOS
        const users = {
            'REY': '44352621',
            'REINA': '45280747'
        };

        // FOTOS DE EJEMPLO
        const defaultPhotos = [
            {
                title: "Nuestro Primer Beso",
                date: "2024-02-14",
                message: "El momento más especial de nuestras vidas...",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23FFB6D9' width='400' height='400'/%3E%3Ctext x='50%25' y='50%25' font-size='40' fill='%23c2185b' text-anchor='middle' dominant-baseline='central' font-family='serif' font-weight='bold'%3E💕 Primer Beso 💕%3C/text%3E%3C/svg%3E",
                type: 'photo'
            }
        ];

        let currentUser = null;
        let currentSlide = 0;
        let photos = [];
        let backgroundMusic = null;
        let audioPlayer = null;

        // RESTAURAR SESIÓN AL CARGAR
        function restoreSession() {
            const savedUser = sessionStorage.getItem('currentUser');
            const savedPhotos = localStorage.getItem('sharedPhotos');
            
            if (savedUser && savedPhotos) {
                currentUser = savedUser;
                photos = JSON.parse(savedPhotos);
                
                // Mostrar app, ocultar login
                document.getElementById('loginContainer').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('mainMenu').classList.remove('hidden');
                document.getElementById('userName').textContent = currentUser;
                
                console.log('✅ Sesión restaurada para:', currentUser);
                return true;
            }
            return false;
        }

        // GUARDAR SESIÓN ACTUAL
        function saveSession() {
            if (currentUser) {
                sessionStorage.setItem('currentUser', currentUser);
                localStorage.setItem('sharedPhotos', JSON.stringify(photos));
                savePhotosWithFolders();
                console.log('✅ Sesión guardada');
            }
        }

        // Guardar sesión cada 5 segundos
        setInterval(saveSession, 5000);

        // Guardar sesión antes de cerrar/recargar
        window.addEventListener('beforeunload', saveSession);
        window.addEventListener('pagehide', saveSession);

        // RELOJ DE CORAZÓN
        function updateHeartClock() {
            const now = new Date();
            const seconds = now.getSeconds();
            const minutes = now.getMinutes();
            const hours = now.getHours() % 12;

            const secondDegrees = (seconds / 60) * 360;
            const minuteDegrees = (minutes / 60) * 360 + (seconds / 60) * 6;
            const hourDegrees = (hours / 12) * 360 + (minutes / 60) * 30;

            document.getElementById('secondHand').style.transform = `rotate(${secondDegrees}deg)`;
            document.getElementById('minuteHand').style.transform = `rotate(${minuteDegrees}deg)`;
            document.getElementById('hourHand').style.transform = `rotate(${hourDegrees}deg)`;
        }

        setInterval(updateHeartClock, 1000);
        updateHeartClock();

        // CONTADOR DE ROSAS
        const START_DATE = new Date('2024-02-14');
        const INITIAL_ROSES = 29;

        function calculateRoses() {
            const now = new Date();
            let months = (now.getFullYear() - START_DATE.getFullYear()) * 12;
            months += now.getMonth() - START_DATE.getMonth();
            if (now.getDate() < START_DATE.getDate()) {
                months--;
            }
            return Math.max(INITIAL_ROSES, INITIAL_ROSES + months);
        }

        function calculateNextRoseDate() {
            const now = new Date();
            let nextRose = new Date(START_DATE);
            const currentRoses = calculateRoses();
            const monthsToAdd = currentRoses - INITIAL_ROSES + 1;
            nextRose.setMonth(nextRose.getMonth() + monthsToAdd);

            const daysUntil = Math.ceil((nextRose - now) / (1000 * 60 * 60 * 24));
            return { date: nextRose, daysUntil: Math.max(0, daysUntil) };
        }

        function displayRoses() {
            const totalRoses = calculateRoses();
            const rosesContainer = document.getElementById('rosesContainer');
            rosesContainer.innerHTML = '';
            
            for (let i = 0; i < totalRoses; i++) {
                const rose = document.createElement('div');
                rose.className = 'rose';
                rose.textContent = '🌹';
                rose.style.animationDelay = `${i * 0.05}s`;
                rose.title = `Rosa ${i + 1}`;
                rosesContainer.appendChild(rose);
            }

            document.getElementById('roseCount').textContent = `${totalRoses} Rosas`;
            
            const monthsText = totalRoses - INITIAL_ROSES === 0 ? 'Inicio del viaje' : `${totalRoses - INITIAL_ROSES} meses juntos`;
            document.getElementById('roseTime').textContent = `${monthsText} 💕`;

            const nextRose = calculateNextRoseDate();
            if (nextRose.daysUntil === 0) {
                document.getElementById('nextRoseDate').textContent = '✨ ¡Nueva rosa disponible hoy!';
                document.getElementById('nextRoseDate').style.color = '#4CAF50';
            } else {
                document.getElementById('nextRoseDate').textContent = `Faltan ${nextRose.daysUntil} días`;
            }

            const now = new Date();
            const dayOfMonth = now.getDate();
            const progressPercent = (dayOfMonth / 31) * 100;
            document.getElementById('roseProgress').style.width = progressPercent + '%';
        }

        function toggleRosesDetails() {
            const details = document.getElementById('rosesDetails');
            details.classList.toggle('show');
        }

        displayRoses();
        setInterval(displayRoses, 60000);

        // LOGIN
        function login(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.toUpperCase().trim();
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('errorMessage');

            errorMsg.classList.remove('show');

            if (!users[username]) {
                errorMsg.textContent = '❌ Usuario no encontrado';
                errorMsg.classList.add('show');
                document.getElementById('password').value = '';
                return;
            }

            if (users[username] !== password) {
                errorMsg.textContent = '❌ Contraseña incorrecta';
                errorMsg.classList.add('show');
                document.getElementById('password').value = '';
                return;
            }

            currentUser = username;
            document.getElementById('userName').textContent = username;
            loadPhotos();
            
            // GUARDAR SESIÓN
            sessionStorage.setItem('currentUser', currentUser);
            localStorage.setItem('sharedPhotos', JSON.stringify(photos));
            
            // CREAR LLUVIA DE ROSAS
            createRoseRain();
            
            document.getElementById('loginContainer').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
            document.getElementById('loginForm').reset();
            
            console.log('✅ Sesión iniciada y guardada para:', currentUser);
        }

        function logout() {
            if (confirm('¿Deseas salir?')) {
                currentUser = null;
                currentSlide = 0;
                
                // LIMPIAR SESIÓN
                sessionStorage.removeItem('currentUser');
                stopBackgroundMusic();
                
                document.getElementById('loginContainer').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
                document.getElementById('loginForm').reset();
                document.getElementById('username').focus();
                
                console.log('✅ Sesión cerrada');
            }
        }

        // FOTOS
        function loadPhotos() {
            const stored = localStorage.getItem('sharedPhotos');
            if (stored) {
                try {
                    photos = JSON.parse(stored);
                } catch (e) {
                    console.error('Error parsing photos:', e);
                    photos = JSON.parse(JSON.stringify(defaultPhotos));
                }
            } else {
                photos = JSON.parse(JSON.stringify(defaultPhotos));
            }
            console.log('Fotos cargadas:', photos.length);
        }

        function createPhotoFolder(date) {
            // Crear carpeta con formato: YYYY-MM-DD
            const dateObj = new Date(date);
            const year = dateObj.getFullYear();
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const day = String(dateObj.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function savePhotosWithFolders() {
            // Guardar fotos organizadas por fecha
            const photosByFolder = {};
            
            photos.forEach(photo => {
                const folder = createPhotoFolder(photo.date);
                if (!photosByFolder[folder]) {
                    photosByFolder[folder] = [];
                }
                photosByFolder[folder].push(photo);
            });

            // Guardar estructura en localStorage
            localStorage.setItem('sharedPhotos', JSON.stringify(photos));
            localStorage.setItem('photoFolders', JSON.stringify(photosByFolder));
            console.log('Fotos guardadas con carpetas:', Object.keys(photosByFolder));
        }

        function showView(view) {
            document.getElementById('mainMenu').classList.add('hidden');
            document.querySelectorAll('[id$="View"]').forEach(el => el.classList.add('hidden'));

            switch(view) {
                case 'upload':
                    displayUploadedItems();
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('photoDate').value = today;
                    document.getElementById('videoDate').value = today;
                    document.getElementById('uploadView').classList.remove('hidden');
                    break;
                case 'music':
                    loadMusicSettings();
                    document.getElementById('musicView').classList.remove('hidden');
                    break;
                case 'carousel':
                    loadCarousel();
                    playBackgroundMusic();
                    document.getElementById('carouselView').classList.remove('hidden');
                    break;
                case 'grid':
                    loadGrid();
                    playBackgroundMusic();
                    document.getElementById('gridView').classList.remove('hidden');
                    break;
            }
        }

        function backToMenu() {
            document.getElementById('mainMenu').classList.remove('hidden');
            document.querySelectorAll('[id$="View"]').forEach(el => el.classList.add('hidden'));
            currentSlide = 0;
            stopBackgroundMusic();
        }

        // MÚSICA DE FONDO
        function extractYouTubeId(url) {
            // Extraer ID de YouTube de diferentes formatos
            let videoId = '';
            
            if (url.includes('youtube.com/watch?v=')) {
                videoId = url.split('v=')[1].split('&')[0];
            } else if (url.includes('youtu.be/')) {
                videoId = url.split('youtu.be/')[1].split('?')[0];
            } else if (url.includes('youtube.com/embed/')) {
                videoId = url.split('/embed/')[1].split('?')[0];
            }
            
            return videoId;
        }

        function loadMusicSettings() {
            const stored = localStorage.getItem('backgroundMusic');
            if (stored) {
                const music = JSON.parse(stored);
                document.getElementById('musicUrl').value = music.url;
                document.getElementById('volumeSlider').value = music.volume || 70;
                document.getElementById('volumeDisplay').textContent = music.volume || 70;
                updateMusicEmbed(music.url);
                updateMusicStatus(true, music.url);
            }
        }

        function updateMusicEmbed(url) {
            const embed = document.getElementById('musicEmbed');
            if (!url) {
                embed.innerHTML = '';
                return;
            }

            const videoId = extractYouTubeId(url);
            if (videoId) {
                embed.innerHTML = `
                    <iframe 
                        width="100%" 
                        height="300" 
                        src="https://www.youtube.com/embed/${videoId}" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen 
                        style="border-radius: 10px;">
                    </iframe>
                `;
            } else {
                embed.innerHTML = '<p style="color: #f44336; text-align: center;">❌ URL de YouTube no válida</p>';
            }
        }

        function updateMusicStatus(active, url = '') {
            const status = document.getElementById('musicStatus');
            if (active && url) {
                status.className = 'music-status active';
                status.innerHTML = '🎵 ¡Música configurada! Sonará en carrusel y rejilla';
            } else {
                status.className = 'music-status inactive';
                status.innerHTML = '🔇 Sin música configurada';
            }
        }

        function updateVolumeDisplay(value) {
            document.getElementById('volumeDisplay').textContent = value;
        }

        function saveBackgroundMusic() {
            const url = document.getElementById('musicUrl').value.trim();
            const volume = document.getElementById('volumeSlider').value;

            if (!url) {
                alert('❌ Por favor ingresa una URL de YouTube');
                return;
            }

            const videoId = extractYouTubeId(url);
            if (!videoId) {
                alert('❌ URL de YouTube no válida. Formatos válidos:\n• https://www.youtube.com/watch?v=...\n• https://youtu.be/...');
                return;
            }

            const musicData = {
                url: url,
                videoId: videoId,
                volume: volume,
                savedDate: new Date().toISOString()
            };

            localStorage.setItem('backgroundMusic', JSON.stringify(musicData));
            backgroundMusic = musicData;

            updateMusicEmbed(url);
            updateMusicStatus(true, url);

            // Mostrar confirmación
            const status = document.getElementById('musicStatus');
            const originalContent = status.innerHTML;
            status.innerHTML = '✅ ¡Música guardada exitosamente!';
            status.style.background = 'rgba(76, 175, 80, 0.2)';
            status.style.color = '#4CAF50';

            setTimeout(() => {
                status.innerHTML = originalContent;
                status.style.background = '';
                status.style.color = '';
                updateMusicStatus(true, url);
            }, 3000);
        }

        function clearBackgroundMusic() {
            if (confirm('¿Estás seguro de que quieres eliminar la música de fondo?')) {
                localStorage.removeItem('backgroundMusic');
                backgroundMusic = null;
                document.getElementById('musicUrl').value = '';
                document.getElementById('musicEmbed').innerHTML = '';
                updateMusicStatus(false);
                stopBackgroundMusic();

                const status = document.getElementById('musicStatus');
                const originalContent = status.innerHTML;
                status.innerHTML = '✅ Música eliminada';
                status.style.background = 'rgba(255, 193, 7, 0.2)';
                status.style.color = '#FFC107';

                setTimeout(() => {
                    status.innerHTML = originalContent;
                    status.style.background = '';
                    status.style.color = '';
                    updateMusicStatus(false);
                }, 2000);
            }
        }

        function playBackgroundMusic() {
            const stored = localStorage.getItem('backgroundMusic');
            if (!stored) return;

            backgroundMusic = JSON.parse(stored);
            const videoId = backgroundMusic.videoId;

            // Detener audio anterior si existe
            if (audioPlayer) {
                audioPlayer.pause();
            }

            // Crear reproductor de audio con YouTube
            const audioUrl = `https://www.youtube.com/embed/${videoId}`;
            
            // Crear iframe oculto para reproducción
            let iframe = document.getElementById('hidden-audio-player');
            if (!iframe) {
                iframe = document.createElement('iframe');
                iframe.id = 'hidden-audio-player';
                iframe.style.display = 'none';
                iframe.allow = 'autoplay';
                document.body.appendChild(iframe);
            }

            iframe.src = `${audioUrl}?autoplay=1&controls=0&loop=1&playlist=${videoId}`;
        }

        function stopBackgroundMusic() {
            const iframe = document.getElementById('hidden-audio-player');
            if (iframe) {
                iframe.src = '';
            }
        }

        // ===== FUNCIONES DE TABS DE MÚSICA =====
        function switchMusicTab(tab) {
            // Ocultar todos los tabs
            document.querySelectorAll('.music-tab-content').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.music-tab-btn').forEach(el => {
                el.classList.remove('active');
            });

            // Mostrar tab seleccionado
            const tabElement = document.getElementById(tab + '-tab');
            if (tabElement) {
                tabElement.classList.add('active');
            }

            // Marcar botón como activo
            event.target.classList.add('active');
        }

        // ===== FUNCIONES PARA SUBIR ARCHIVO DE MÚSICA =====
        let uploadedMusicData = null;

        function handleMusicFileUpload() {
            const file = document.getElementById('musicFileInput').files[0];
            if (!file) return;

            // Validar tamaño
            if (file.size > 50 * 1024 * 1024) {
                alert('❌ El archivo es muy grande (máximo 50MB)');
                return;
            }

            // Validar formato
            const validFormats = ['audio/mpeg', 'audio/wav', 'audio/ogg', 'audio/mp4', 'audio/webm'];
            if (!validFormats.includes(file.type)) {
                alert('❌ Formato no soportado. Usa MP3, WAV, OGG, M4A o WebM');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedMusicData = {
                    name: file.name,
                    data: e.target.result,
                    type: file.type,
                    volume: document.getElementById('uploadVolumeSlider').value,
                    savedDate: new Date().toISOString()
                };

                // Mostrar previsualización
                displayMusicUploadPreview(file.name);
            };

            reader.readAsDataURL(file);
        }

        function displayMusicUploadPreview(fileName) {
            const preview = document.getElementById('musicUploadPreview');
            const status = document.getElementById('uploadMusicStatus');

            preview.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 2em; margin-bottom: 10px;">🎵</div>
                    <p style="color: #5a3a5a; font-weight: 600;">${fileName}</p>
                    <p style="color: #999; font-size: 0.9em;">Archivo listo para guardar</p>
                </div>
            `;

            status.className = 'music-status active';
            status.innerHTML = '✅ Archivo cargado correctamente';
        }

        function saveUploadedMusic() {
            if (!uploadedMusicData) {
                alert('❌ Por favor selecciona un archivo de música primero');
                return;
            }

            localStorage.setItem('uploadedMusic', JSON.stringify(uploadedMusicData));

            // Mostrar mensaje de éxito
            const status = document.getElementById('uploadMusicStatus');
            const originalContent = status.innerHTML;
            status.className = 'music-status active';
            status.innerHTML = '✅ ¡Música guardada exitosamente!';

            setTimeout(() => {
                status.innerHTML = originalContent;
            }, 3000);

            console.log('✅ Música guardada:', uploadedMusicData.name);
        }

        function clearUploadedMusic() {
            if (confirm('¿Estás seguro de que quieres eliminar la música cargada?')) {
                uploadedMusicData = null;
                localStorage.removeItem('uploadedMusic');
                document.getElementById('musicFileInput').value = '';
                document.getElementById('musicUploadPreview').innerHTML = '';

                const status = document.getElementById('uploadMusicStatus');
                status.className = 'music-status inactive';
                status.innerHTML = '🔇 Sin archivo cargado';

                console.log('✅ Música eliminada');
            }
        }

        function updateUploadVolumeDisplay(value) {
            document.getElementById('uploadVolumeDisplay').textContent = value;
        }

        function playUploadedMusic() {
            const musicData = localStorage.getItem('uploadedMusic');
            if (!musicData) return;

            const music = JSON.parse(musicData);
            let audioElement = document.getElementById('uploaded-audio-player');

            if (!audioElement) {
                audioElement = document.createElement('audio');
                audioElement.id = 'uploaded-audio-player';
                audioElement.style.display = 'none';
                audioElement.controls = false;
                audioElement.loop = true;
                audioElement.autoplay = true;
                document.body.appendChild(audioElement);
            }

            audioElement.src = music.data;
            audioElement.volume = music.volume / 100;
            audioElement.play();
        }

        function showYoutubeAudioInfo() {
            alert(`
📚 YOUTUBE AUDIO LIBRARY

📍 ¿Dónde encontrarla?
1. Ve a YouTube Studio
2. En el menú lateral: "Creación" → "Sonidos"
3. Busca canción que quieras

📥 ¿Cómo descargarla?
1. Algunos videos permiten descargar
2. O usa: https://www.y2mate.com/
3. Descárgalo como MP3

📤 Luego:
1. Vuelve a esta pestaña
2. Click en "Subir Archivo"
3. Selecciona el MP3 descargado
4. ¡Listo! Úsalo sin anuncios

¡Las canciones de YouTube Audio Library son 100% libres de derechos!
            `);
        }

        // ===== LLUVIA DE ROSAS AL LOGIN =====
        function createRoseRain() {
            const container = document.createElement('div');
            container.className = 'rose-rain-container';
            document.body.appendChild(container);

            // Crear 50 rosas
            const roseCount = 50;
            for (let i = 0; i < roseCount; i++) {
                const rose = document.createElement('div');
                rose.className = 'rose-rain';
                rose.textContent = '🌹';
                
                // Posición horizontal aleatoria
                const randomLeft = Math.random() * 100;
                rose.style.left = randomLeft + '%';
                
                // Duración aleatoria entre 3 a 5 segundos
                const duration = 3 + Math.random() * 2;
                rose.style.animationDuration = duration + 's';
                
                // Delay aleatorio
                const delay = Math.random() * 0.5;
                rose.style.animationDelay = delay + 's';
                
                // Velocidad de swing aleatoria
                const swingDuration = 1 + Math.random() * 1;
                rose.style.setProperty('--swing-duration', swingDuration + 's');
                
                container.appendChild(rose);
            }

            // Remover container después de la animación
            setTimeout(() => {
                container.remove();
            }, 6000);
        }

        // CARGA DE FOTOS Y VIDEOS
        function switchUploadTab(tab) {
            document.querySelectorAll('.tab-content-upload').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-link').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tab + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        function uploadPhoto(event) {
            event.preventDefault();
            
            const file = document.getElementById('photoInput').files[0];
            if (!file) return;

            // Validar tamaño
            if (file.size > 50 * 1024 * 1024) {
                showMessage('photoMessage', '❌ La foto es demasiado grande (máximo 50MB)', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const newPhoto = {
                    title: document.getElementById('photoTitle').value,
                    date: document.getElementById('photoDate').value,
                    message: document.getElementById('photoMessage').value,
                    image: e.target.result,
                    type: 'photo'
                };

                photos.push(newPhoto);
                savePhotos();
                displayUploadedItems();

                // MOSTRAR MENSAJE CON PREVIEW
                const currentCount = photos.length;
                showPhotoSuccessMessage(newPhoto, currentCount);
                
                document.getElementById('photoForm').reset();
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('photoDate').value = today;
            };

            reader.readAsDataURL(file);
        }

        function showPhotoSuccessMessage(photo, totalCount) {
            const container = document.body;
            const notification = document.createElement('div');
            notification.className = 'photo-success-notification';
            notification.innerHTML = `
                <div class="notification-card">
                    <div class="notification-header">
                        ✅ ¡Foto Guardada Exitosamente!
                    </div>
                    
                    <div class="notification-preview">
                        <div class="preview-image">
                            <img src="${photo.image}" alt="${photo.title}" 
                                style="width: 100%; height: 150px; object-fit: cover; border-radius: 10px;">
                        </div>
                        
                        <div class="preview-info">
                            <div class="preview-title">📸 ${photo.title}</div>
                            <div class="preview-date">📅 ${new Date(photo.date).toLocaleDateString('es-ES', 
                                {year: 'numeric', month: 'long', day: 'numeric'})}</div>
                            <div class="preview-message">💌 ${photo.message || 'Sin mensaje'}</div>
                        </div>
                    </div>
                    
                    <div class="notification-stats">
                        <div class="stat-item">
                            <span class="stat-label">Total de Fotos:</span>
                            <span class="stat-value">${totalCount}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Almacenamiento:</span>
                            <span class="stat-value">${(localStorage.getItem('sharedPhotos').length / 1024 / 1024).toFixed(2)} MB</span>
                        </div>
                    </div>
                    
                    <div class="notification-footer">
                        <p>Tu foto ha sido guardada correctamente en el álbum 🎉</p>
                    </div>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Auto-cerrar después de 5 segundos
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }

        function uploadVideo(event) {
            event.preventDefault();
            
            const file = document.getElementById('videoInput').files[0];
            if (!file) {
                showMessage('videoMessage', '❌ Por favor selecciona un video', 'error');
                return;
            }

            if (file.size > 100 * 1024 * 1024) {
                showMessage('videoMessage', '❌ El video es demasiado grande (máximo 100MB)', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const newVideo = {
                    title: document.getElementById('videoTitle').value,
                    date: document.getElementById('videoDate').value,
                    message: document.getElementById('videoMessage').value,
                    image: e.target.result,
                    type: 'video'
                };

                photos.push(newVideo);
                savePhotos();
                displayUploadedItems();

                showMessage('videoMessage', '✅ ¡Video guardado exitosamente!', 'success');
                document.getElementById('videoForm').reset();
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('videoDate').value = today;
            };

            reader.readAsDataURL(file);
        }

        function showMessage(elementId, text, type) {
            const messageDiv = document.getElementById(elementId);
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 4000);
        }

        function displayUploadedItems() {
            const container = document.getElementById('uploadedItems');
            container.innerHTML = '';

            if (photos.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1;"><div class="empty-state"><h3>Sin contenido aún</h3><p>¡Sube tus primeras fotos y videos! 💕</p></div></div>';
                return;
            }

            photos.forEach((photo, index) => {
                const item = document.createElement('div');
                item.className = 'preview-item';
                
                let mediaHTML = '';
                if (photo.type === 'video') {
                    mediaHTML = `<video src="${photo.image}" style="width: 100%; height: 150px; object-fit: cover;"></video>`;
                } else {
                    mediaHTML = `<img src="${photo.image}" alt="${photo.title}">`;
                }

                item.innerHTML = `
                    ${mediaHTML}
                    <div class="preview-info">
                        ${photo.type === 'video' ? '🎥' : '📸'} ${photo.title.substring(0, 15)}...
                    </div>
                    <button class="preview-delete" onclick="deleteItem(${index})" title="Eliminar">×</button>
                `;
                container.appendChild(item);
            });
        }

        function deleteItem(index) {
            if (confirm('¿Estás seguro de que quieres eliminar este elemento?')) {
                photos.splice(index, 1);
                savePhotos();
                displayUploadedItems();
            }
        }

        function savePhotos() {
            localStorage.setItem('sharedPhotos', JSON.stringify(photos));
            savePhotosWithFolders(); // También crear estructura de carpetas
            console.log('Fotos guardadas. Total:', photos.length);
        }

        // CARRUSEL
        function loadCarousel() {
            const carousel = document.getElementById('carousel');
            carousel.innerHTML = '';
            currentSlide = 0;

            if (photos.length === 0) {
                carousel.innerHTML = '<div class="empty-state"><h3>Sin fotos</h3></div>';
                return;
            }

            photos.forEach((photo, index) => {
                const slide = document.createElement('div');
                slide.className = 'carousel-slide' + (index === 0 ? ' active' : '');
                if (photo.type === 'video') {
                    slide.innerHTML = `<video src="${photo.image}" controls style="max-width: 100%; max-height: 100%; border-radius: 15px;"></video>`;
                } else {
                    slide.innerHTML = `<img src="${photo.image}" alt="${photo.title}">`;
                }
                carousel.appendChild(slide);
            });

            updateCarousel();
        }

        function updateCarousel() {
            const slides = document.querySelectorAll('#carousel .carousel-slide');
            slides.forEach(s => s.classList.remove('active'));
            slides[currentSlide].classList.add('active');

            document.getElementById('prevBtn').disabled = currentSlide === 0;
            document.getElementById('nextBtn').disabled = currentSlide === slides.length - 1;
            document.getElementById('currentSlide').textContent = currentSlide + 1;
            document.getElementById('totalSlides').textContent = slides.length;

            const photo = photos[currentSlide];
            document.getElementById('slideInfo').innerHTML = `
                <div class="slide-title">${photo.title}</div>
                <div class="slide-date">${new Date(photo.date).toLocaleDateString('es-ES', {year: 'numeric', month: 'long', day: 'numeric'})}</div>
                <div class="slide-message">"${photo.message}"</div>
            `;
        }

        function nextSlide() {
            if (currentSlide < photos.length - 1) {
                currentSlide++;
                updateCarousel();
            }
        }

        function previousSlide() {
            if (currentSlide > 0) {
                currentSlide--;
                updateCarousel();
            }
        }

        // REJILLA
        function loadGrid() {
            const container = document.getElementById('gridContainer');
            container.innerHTML = '';

            if (photos.length === 0) {
                container.innerHTML = '<div class="empty-state" style="grid-column: 1/-1;"><h3>Sin fotos</h3></div>';
                return;
            }

            photos.forEach((photo, index) => {
                const item = document.createElement('div');
                item.className = 'grid-item';
                if (photo.type === 'video') {
                    item.innerHTML = `
                        <video src="${photo.image}" style="width: 100%; height: 250px; object-fit: cover;"></video>
                        <div class="grid-info">
                            <div class="grid-title">🎥 ${photo.title}</div>
                            <div class="grid-date">${new Date(photo.date).toLocaleDateString('es-ES', {month: 'short', day: 'numeric'})}</div>
                        </div>
                    `;
                } else {
                    item.innerHTML = `
                        <img src="${photo.image}" alt="${photo.title}" class="grid-image">
                        <div class="grid-info">
                            <div class="grid-title">📸 ${photo.title}</div>
                            <div class="grid-date">${new Date(photo.date).toLocaleDateString('es-ES', {month: 'short', day: 'numeric'})}</div>
                        </div>
                    `;
                }
                container.appendChild(item);
            });
        }

        // COMPARTIR ÁLBUM PÚBLICO
        function showShareModal() {
            const shareLink = generatePublicLink();
            document.getElementById('shareLink').value = shareLink;
            document.getElementById('shareModal').classList.add('show');
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('show');
        }

        function generatePublicLink() {
            // Generar enlace público válido
            const baseUrl = window.location.origin + window.location.pathname;
            
            // Usar fotos actuales o por defecto
            const photosToShare = photos.length > 0 ? photos : defaultPhotos;
            
            // Crear ID único sin caracteres especiales
            const timestamp = Date.now().toString(36);
            const random = Math.random().toString(36).substring(2, 15);
            const publicId = (timestamp + random).substring(0, 20);
            
            // Guardar datos públicos CON MÚSICA
            const publicAlbumData = {
                photos: photosToShare,
                owner: currentUser || 'Anónimo',
                date: new Date().toISOString(),
                rosas: calculateRoses(),
                nextRose: calculateNextRoseDate()
            };
            
            // Intentar agregar música si existe
            try {
                const musicData = localStorage.getItem('backgroundMusic');
                if (musicData) {
                    publicAlbumData.music = musicData;
                }
            } catch (e) {
                console.log('No hay música YouTube');
            }
            
            try {
                const uploadedMusic = localStorage.getItem('uploadedMusic');
                if (uploadedMusic) {
                    publicAlbumData.uploadedMusic = uploadedMusic;
                }
            } catch (e) {
                console.log('No hay música descargada');
            }
            
            // Guardar en localStorage
            localStorage.setItem('public_' + publicId, JSON.stringify(publicAlbumData));
            
            // Generar URL pública COMPLETA y válida
            const publicUrl = baseUrl + '?public=' + publicId;
            
            console.log('✅ Álbum público creado:', publicUrl);
            console.log('✅ ID público:', publicId);
            console.log('✅ Fotos:', photosToShare.length);
            
            return publicUrl;
        }

        function copyShareLink() {
            const shareLink = document.getElementById('shareLink');
            shareLink.select();
            document.execCommand('copy');
            
            const copyBtn = document.querySelector('.copy-btn');
            copyBtn.textContent = '✅ ¡Enlace Copiado!';
            copyBtn.classList.add('copied');
            
            setTimeout(() => {
                copyBtn.textContent = '📋 Copiar Enlace';
                copyBtn.classList.remove('copied');
            }, 2000);
        }

        function openPublicAlbum() {
            const shareLink = document.getElementById('shareLink').value;
            window.open(shareLink, '_blank');
        }


        // INTENTAR RESTAURAR SESIÓN AL RECARGAR
        const sessionRestored = restoreSession();

        // ===== VERIFICAR ACCESO PÚBLICO (ANTES DE LOGIN) =====
        const urlParams = new URLSearchParams(window.location.search);
        const publicId = urlParams.get('public');

        if (publicId) {
            // Es acceso público - NO mostrar login
            const publicData = localStorage.getItem('public_' + publicId);
            if (publicData) {
                try {
                    const albumData = JSON.parse(publicData);
                    photos = albumData.photos || [];
                    
                    // OCULTAR LOGIN COMPLETAMENTE
                    document.getElementById('loginContainer').classList.add('hidden');
                    document.getElementById('mainApp').classList.add('hidden');
                    document.getElementById('publicAlbumContainer').classList.remove('hidden');
                    
                    // Iniciar reloj y rosas público
                    updatePublicHeartClock();
                    displayPublicRoses();
                    setInterval(updatePublicHeartClock, 1000);
                    setInterval(displayPublicRoses, 60000);
                    
                    // Cargar música si existe
                    if (albumData.music) {
                        backgroundMusic = JSON.parse(albumData.music);
                    }
                    if (albumData.uploadedMusic) {
                        uploadedMusicData = JSON.parse(albumData.uploadedMusic);
                    }
                    
                    console.log('✅ Álbum público cargado:', photos.length, 'elementos');
                } catch (e) {
                    console.error('Error loading public album:', e);
                    alert('❌ Álbum no encontrado o expirado');
                    // Volver a URL base sin parámetro
                    window.location.href = window.location.pathname;
                }
            } else {
                alert('❌ Este álbum ya no está disponible');
                // Volver a URL base sin parámetro
                window.location.href = window.location.pathname;
            }
        }

        // ===== FUNCIONES DE VISTA PÚBLICA =====
        let publicCurrentSlide = 0;

        function updatePublicHeartClock() {
            const now = new Date();
            const seconds = now.getSeconds();
            const minutes = now.getMinutes();
            const hours = now.getHours() % 12;

            const secondDegrees = (seconds / 60) * 360;
            const minuteDegrees = (minutes / 60) * 360 + (seconds / 60) * 6;
            const hourDegrees = (hours / 12) * 360 + (minutes / 60) * 30;

            if (document.getElementById('publicSecondHand')) {
                document.getElementById('publicSecondHand').style.transform = `rotate(${secondDegrees}deg)`;
                document.getElementById('publicMinuteHand').style.transform = `rotate(${minuteDegrees}deg)`;
                document.getElementById('publicHourHand').style.transform = `rotate(${hourDegrees}deg)`;
            }
        }

        function displayPublicRoses() {
            const totalRoses = calculateRoses();
            const rosesContainer = document.getElementById('publicRosesContainer');
            if (!rosesContainer) return;
            
            rosesContainer.innerHTML = '';
            
            for (let i = 0; i < totalRoses; i++) {
                const rose = document.createElement('div');
                rose.className = 'rose';
                rose.textContent = '🌹';
                rose.style.animationDelay = `${i * 0.05}s`;
                rosesContainer.appendChild(rose);
            }

            document.getElementById('publicRoseCount').textContent = `${totalRoses} Rosas`;
            const monthsText = totalRoses - INITIAL_ROSES === 0 ? 'Inicio del viaje' : `${totalRoses - INITIAL_ROSES} meses juntos`;
            document.getElementById('publicRoseTime').textContent = `${monthsText} 💕`;

            const nextRose = calculateNextRoseDate();
            document.getElementById('publicNextRoseDate').textContent = nextRose.daysUntil === 0 ? 
                '✨ ¡Nueva rosa hoy!' : `Faltan ${nextRose.daysUntil} días`;

            const now = new Date();
            const dayOfMonth = now.getDate();
            document.getElementById('publicRoseProgress').style.width = ((dayOfMonth / 31) * 100) + '%';
        }

        function togglePublicRosesDetails() {
            const details = document.getElementById('publicRosesDetails');
            if (details) details.classList.toggle('show');
        }

        function showPublicView(view) {
            document.getElementById('publicMenu').classList.add('hidden');
            document.querySelectorAll('[id^="public"][id$="View"]').forEach(el => el.classList.add('hidden'));

            if (view === 'carousel') {
                loadPublicCarousel();
                document.getElementById('publicCarouselView').classList.remove('hidden');
                playBackgroundMusic();
            } else if (view === 'grid') {
                loadPublicGrid();
                document.getElementById('publicGridView').classList.remove('hidden');
                playBackgroundMusic();
            }
        }

        function backToPublicMenu() {
            document.getElementById('publicMenu').classList.remove('hidden');
            document.querySelectorAll('[id^="public"][id$="View"]').forEach(el => el.classList.add('hidden'));
            publicCurrentSlide = 0;
            stopBackgroundMusic();
        }

        function loadPublicCarousel() {
            const carousel = document.getElementById('publicCarousel');
            carousel.innerHTML = '';
            publicCurrentSlide = 0;

            if (photos.length === 0) {
                carousel.innerHTML = '<div class="empty-state"><h3>Sin fotos</h3></div>';
                return;
            }

            photos.forEach((photo, index) => {
                const slide = document.createElement('div');
                slide.className = 'carousel-slide' + (index === 0 ? ' active' : '');
                if (photo.type === 'video') {
                    slide.innerHTML = `<video src="${photo.image}" controls style="max-width: 100%; max-height: 100%; border-radius: 15px;"></video>`;
                } else {
                    slide.innerHTML = `<img src="${photo.image}" alt="${photo.title}">`;
                }
                carousel.appendChild(slide);
            });

            updatePublicCarousel();
        }

        function updatePublicCarousel() {
            const slides = document.querySelectorAll('#publicCarousel .carousel-slide');
            slides.forEach(s => s.classList.remove('active'));
            if (slides[publicCurrentSlide]) slides[publicCurrentSlide].classList.add('active');

            document.getElementById('publicPrevBtn').disabled = publicCurrentSlide === 0;
            document.getElementById('publicNextBtn').disabled = publicCurrentSlide === slides.length - 1;
            document.getElementById('publicCurrentSlide').textContent = publicCurrentSlide + 1;
            document.getElementById('publicTotalSlides').textContent = slides.length;

            if (photos[publicCurrentSlide]) {
                const photo = photos[publicCurrentSlide];
                document.getElementById('publicSlideInfo').innerHTML = `
                    <div class="slide-title">${photo.title}</div>
                    <div class="slide-date">${new Date(photo.date).toLocaleDateString('es-ES', {year: 'numeric', month: 'long', day: 'numeric'})}</div>
                    <div class="slide-message">"${photo.message}"</div>
                `;
            }
        }

        function nextPublicSlide() {
            if (publicCurrentSlide < photos.length - 1) {
                publicCurrentSlide++;
                updatePublicCarousel();
            }
        }

        function previousPublicSlide() {
            if (publicCurrentSlide > 0) {
                publicCurrentSlide--;
                updatePublicCarousel();
            }
        }

        function loadPublicGrid() {
            const container = document.getElementById('publicGridContainer');
            container.innerHTML = '';

            if (photos.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>Sin fotos</h3></div>';
                return;
            }

            photos.forEach((photo, index) => {
                const item = document.createElement('div');
                item.className = 'grid-item';
                if (photo.type === 'video') {
                    item.innerHTML = `
                        <video src="${photo.image}" style="width: 100%; height: 250px; object-fit: cover;"></video>
                        <div class="grid-info">
                            <div class="grid-title">🎥 ${photo.title}</div>
                            <div class="grid-date">${new Date(photo.date).toLocaleDateString('es-ES', {month: 'short', day: 'numeric'})}</div>
                        </div>
                    `;
                } else {
                    item.innerHTML = `
                        <img src="${photo.image}" alt="${photo.title}" class="grid-image">
                        <div class="grid-info">
                            <div class="grid-title">📸 ${photo.title}</div>
                            <div class="grid-date">${new Date(photo.date).toLocaleDateString('es-ES', {month: 'short', day: 'numeric'})}</div>
                        </div>
                    `;
                }
                container.appendChild(item);
            });
        }

        // ===== INICIALIZACIÓN PRINCIPAL =====
        loadPhotos();

        // VERIFICAR ACCESO PÚBLICO PRIMERO
        const urlParams = new URLSearchParams(window.location.search);
        const publicId = urlParams.get('public');

        if (publicId) {
            // ACCESO PÚBLICO - Sin login requerido
            console.log('🔓 Detectado parámetro público:', publicId);
            
            const publicData = localStorage.getItem('public_' + publicId);
            
            if (publicData) {
                try {
                    const albumData = JSON.parse(publicData);
                    photos = albumData.photos || [];
                    
                    console.log('✅ Datos públicos encontrados');
                    console.log('✅ Fotos:', photos.length);
                    
                    // Ocultar UI de login
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'none';
                    document.getElementById('publicAlbumContainer').style.display = 'block';
                    
                    // Inicializar vistas públicas
                    setTimeout(() => {
                        updatePublicHeartClock();
                        displayPublicRoses();
                        setInterval(updatePublicHeartClock, 1000);
                        setInterval(displayPublicRoses, 60000);
                        
                        console.log('✅ Álbum público listo para ver');
                    }, 100);
                    
                } catch (error) {
                    console.error('❌ Error:', error);
                    alert('❌ No se pudo cargar el álbum público.');
                }
            } else {
                console.error('❌ Álbum público no existe:', publicId);
                alert('❌ Este enlace ya no es válido o ha expirado.');
            }
        } else {
            // LOGIN NORMAL - Intentar restaurar sesión
            console.log('🔐 Modo login normal');
            const sessionRestored = restoreSession();
            if (sessionRestored) {
                console.log('✅ Sesión restaurada');
            } else {
                console.log('ℹ️ Sesión no encontrada, mostrar login');
            }
        }
    </script>
</body>
</html>
